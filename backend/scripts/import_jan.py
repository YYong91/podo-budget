"""2026년 1월 실제 데이터 임포트 스크립트"""

import asyncio
from datetime import datetime

from sqlalchemy import text

from app.core.database import AsyncSessionLocal
from app.services.category_service import get_or_create_category

USER_ID = 6  # yyong

# 대분류 기반 카테고리
EXPENSES = [
    # === 저축성지출 ===
    ("2026-01-01", "저축성지출", "채이 용돈", 100000),
    ("2026-01-12", "저축성지출", "승용 개인연금저축", 500000),
    ("2026-01-12", "저축성지출", "연금보험", 300000),
    # === 고정지출 ===
    ("2026-01-01", "용돈", "승용 용돈", 300000),
    ("2026-01-01", "용돈", "석화 용돈", 300000),
    ("2026-01-04", "문화생활비", "Apple One", 19809),
    ("2026-01-10", "의료비", "채이 보험", 61120),
    ("2026-01-10", "통신비", "석화 통신비", 50000),
    ("2026-01-10", "의료비", "석화 보험료", 160000),
    ("2026-01-11", "통신비", "LGU+", 22000),
    ("2026-01-12", "교통비", "운전자 보험", 10000),
    ("2026-01-12", "문화생활비", "여행적금", 300000),
    ("2026-01-12", "의료비", "승용 보험", 152650),
    ("2026-01-14", "교통비", "티머니", 50000),
    ("2026-01-14", "통신비", "승용 통신비", 49400),
    ("2026-01-15", "생필품비", "쿠팡 와우", 6900),
    ("2026-01-15", "통신비", "티 우주", 2000),
    ("2026-01-23", "통신비", "애플 icloud 2tb", 12922),
    ("2026-01-23", "문화생활비", "쿠팡 스포츠패스", 9900),
    ("2026-01-25", "생필품비", "쿠팡 와우", 7890),
    ("2026-01-27", "주거비", "아파트 관리비", 388550),
    # === 변동지출 ===
    ("2026-01-01", "외식비", "쿠팡이츠", 23500),
    ("2026-01-01", "생필품비", "쿠팡", 23790),
    ("2026-01-02", "교통비", "전기차 충전", 13522),
    ("2026-01-02", "생필품비", "세빛 선물", 16270),
    ("2026-01-03", "생필품비", "수향미", 42900),
    ("2026-01-03", "생필품비", "도언 선물", 46450),
    ("2026-01-03", "생필품비", "농민마트", 19150),
    ("2026-01-03", "생필품비", "빨래건조대", 13150),
    ("2026-01-03", "생필품비", "쿠팡", 34220),
    ("2026-01-04", "생필품비", "코스트코 로션, 쌍화탕", 47480),
    ("2026-01-04", "생필품비", "주방세제", 4900),
    ("2026-01-04", "생필품비", "쿠팡", 10880),
    ("2026-01-04", "생필품비", "도언 귤", 18540),
    ("2026-01-04", "교통비", "티머니", 10000),
    ("2026-01-05", "외식비", "맥도널드", 17900),
    ("2026-01-06", "교통비", "전기차 충전", 17026),
    ("2026-01-06", "교통비", "하이패스", 50000),
    ("2026-01-06", "외식비", "하얀풍차", 35950),
    ("2026-01-06", "생필품비", "롯데슈퍼", 4690),
    ("2026-01-07", "외식비", "딸기케이크", 35000),
    ("2026-01-07", "외식비", "월드몰 점심 한식 반상", 36000),
    ("2026-01-07", "교통비", "잠실 주차비", 7400),
    ("2026-01-07", "교통비", "손세차", 38000),
    ("2026-01-07", "생필품비", "쿠팡", 42000),
    ("2026-01-07", "생필품비", "채이 로션", 18300),
    ("2026-01-08", "기타 비용", "법무사", 1200000),
    ("2026-01-08", "주거비", "전세이자", 373870),
    ("2026-01-08", "외식비", "만나분식", 12900),
    ("2026-01-09", "의료비", "안과", 8600),
    ("2026-01-09", "의료비", "소아과", 4900),
    ("2026-01-09", "의료비", "약국", 4700),
    ("2026-01-09", "의료비", "약국", 1800),
    ("2026-01-09", "외식비", "우지커피", 6900),
    ("2026-01-10", "경조사회비", "준형 축의금", 100000),
    ("2026-01-10", "외식비", "복피자 쿠팡이츠", 14000),
    ("2026-01-11", "경조사회비", "석민 축의금", 100000),
    ("2026-01-11", "생필품비", "오아시스", 28788),
    ("2026-01-11", "교통비", "주차비", 1000),
    ("2026-01-11", "생필품비", "쿠팡", 64660),
    ("2026-01-12", "생필품비", "건강예찬 반찬", 38200),
    ("2026-01-13", "생필품비", "차 워셔액", 3880),
    ("2026-01-14", "의료비", "파스", 4000),
    ("2026-01-14", "생필품비", "쿠팡", 19420),
    ("2026-01-14", "생필품비", "쿠팡", 53490),
    ("2026-01-14", "외식비", "쿠팡이츠 자담치킨", 24240),
    ("2026-01-14", "생필품비", "기저귀", 125640),
    ("2026-01-15", "의료비", "정형외과 허리", 124790),
    ("2026-01-15", "의료비", "약국", 2900),
    ("2026-01-15", "교통비", "자동차세", 124040),
    ("2026-01-16", "외식비", "쿠팡이츠 디저트", 15294),
    ("2026-01-16", "생필품비", "쿠팡", 23320),
    ("2026-01-17", "생필품비", "홈플러스 부대찌게 밀키트", 10900),
    ("2026-01-18", "외식비", "베어스타코", 26800),
    ("2026-01-18", "생필품비", "쿠팡", 22030),
    ("2026-01-18", "외식비", "던킨도너츠", 14200),
    ("2026-01-18", "외식비", "음료수 편의점", 2300),
    ("2026-01-20", "생필품비", "매직캔 리필", 9790),
    ("2026-01-21", "생필품비", "커피머신 당근", 50000),
    ("2026-01-21", "생필품비", "쿠팡", 13500),
    ("2026-01-22", "외식비", "복피자 쿠팡이츠", 15965),
    ("2026-01-23", "생필품비", "롤휴지", 38990),
    ("2026-01-23", "생필품비", "쿠팡", 33360),
    ("2026-01-23", "생필품비", "쿠팡", 17230),
    ("2026-01-25", "외식비", "마라샹궈 쿠팡이츠", 26900),
    ("2026-01-26", "생필품비", "채이 반찬 뽀뽀뜨", 32300),
    ("2026-01-27", "생필품비", "채이 수건", 24300),
    ("2026-01-27", "생필품비", "채이 칫솔 손수건", 18900),
    ("2026-01-27", "외식비", "쿠팡이츠 맥도날드", 24000),
    ("2026-01-27", "외식비", "쿠팡이츠 파스타", 11000),
    ("2026-01-28", "생필품비", "쿠팡", 21660),
    ("2026-01-29", "생필품비", "쿠팡", 44010),
    ("2026-01-30", "교육비", "레버리지 교육", 4000),
    ("2026-01-30", "생필품비", "쿠팡", 50680),
    ("2026-01-30", "경조사회비", "산 축의금", 500000),
]


async def main():
    async with AsyncSessionLocal() as db:
        # 1) 기존 테스트 데이터 삭제 (FK 순서 준수)
        await db.execute(text("DELETE FROM expenses"))
        await db.execute(text("DELETE FROM incomes"))
        await db.execute(text("DELETE FROM budgets"))
        await db.execute(text("DELETE FROM categories"))
        await db.commit()
        print("기존 데이터 삭제 완료")

        # 2) 카테고리 캐시 (중복 생성 방지)
        cat_cache = {}

        # 3) 지출 데이터 삽입
        count = 0
        for date_str, category_name, description, amount in EXPENSES:
            if category_name not in cat_cache:
                cat = await get_or_create_category(db, category_name, user_id=USER_ID)
                cat_cache[category_name] = cat.id

            await db.execute(
                text(
                    "INSERT INTO expenses (user_id, category_id, amount, description, date, created_at, updated_at) "
                    "VALUES (:uid, :cid, :amount, :desc, :date, NOW(), NOW())"
                ),
                {
                    "uid": USER_ID,
                    "cid": cat_cache[category_name],
                    "amount": amount,
                    "desc": description,
                    "date": datetime.fromisoformat(date_str),
                },
            )
            count += 1

        await db.commit()
        print(f"1월 지출 {count}건 삽입 완료")

        # 4) 검증
        result = await db.execute(
            text("SELECT COUNT(*), SUM(amount) FROM expenses WHERE user_id = :uid"),
            {"uid": USER_ID},
        )
        row = result.fetchone()
        print(f"총 {row[0]}건, 합계 ₩{row[1]:,.0f}")


asyncio.run(main())
